(function(c,b,d){var a;
b.Granite=b.Granite||{};
b.Granite.$=b.Granite.$||c;
b._g=b._g||{};
b._g.$=b._g.$||c;
a=Granite.HTTP;
c.ajaxSetup({externalize:true,encodePath:true,hook:true,beforeSend:function(f,e){if(typeof G_IS_HOOKED=="undefined"||!G_IS_HOOKED(e.url)){if(e.externalize){e.url=a.externalize(e.url)
}if(e.encodePath){e.url=a.encodePathOfURI(e.url)
}}if(e.hook){var g=a.getXhrHook(e.url,e.type,e.data);
if(g){e.url=g.url;
if(g.params){if(e.type.toUpperCase()=="GET"){e.url+="?"+c.param(g.params)
}else{e.data=c.param(g.params)
}}}}},statusCode:{403:function(e){if(e.getResponseHeader("X-Reason")==="Authentication Failed"){a.handleLoginRedirect()
}}}});
c.ajaxSettings.traditional=true
}(jQuery,this));
(function(e,b){e.Granite=e.Granite||{};
if(e.Granite.csrf){return
}e.Granite.csrf={initialised:false,refreshToken:l};
function h(){this._handler=[]
}h.prototype={then:function(r,q){this._handler.push({resolve:r,reject:q})
},resolve:function(){this._execute("resolve",arguments)
},reject:function(){this._execute("reject",arguments)
},_execute:function(q,r){if(this._handler===null){throw new Error("Promise already completed.")
}for(var s=0,t=this._handler.length;
s<t;
s++){this._handler[s][q].apply(e,r)
}this.then=function(v,u){(q==="resolve"?v:u).apply(e,r)
};
this._handler=null
}};
function i(r){var s=document.location.host,u=document.location.protocol,t="//"+s,q=u+t;
return(r==q||r.slice(0,q.length+1)==q+"/")||(r==t||r.slice(0,t.length+1)==t+"/")||!(/^(\/\/|http:|https:).*/.test(r))
}var k=":cq_csrf_token",j="CSRF-Token",m="/libs/granite/csrf/token.json";
var p,g;
function l(){p=new h();
var q=new XMLHttpRequest();
q.onreadystatechange=function(){if(q.readyState===4){try{var s=JSON.parse(q.responseText);
g=s.token;
p.resolve(g)
}catch(r){p.reject(q.responseText)
}}};
q.open("GET",Granite.HTTP.externalize(m),true);
q.send();
return p
}function a(r){var s=r.getAttribute("action");
if(s&&!i(s)){return
}var q=r.querySelector('input[name="'+k+'"]');
if(!q){q=document.createElement("input");
q.setAttribute("type","hidden");
q.setAttribute("name",k);
r.appendChild(q)
}q.setAttribute("value",g)
}function n(q){var r=function(u){var s=u.target;
if(s.nodeName.toLowerCase()==="form"&&g){a(s)
}};
if(q.addEventListener){q.addEventListener("submit",r,true)
}else{if(q.attachEvent){q.attachEvent("submit",r)
}}}l();
n(document);
var d=XMLHttpRequest.prototype.open;
XMLHttpRequest.prototype.open=function(r,q){if(i(q)&&r.toLowerCase()!=="get"){this._csrf=true
}return d.apply(this,arguments)
};
var c=XMLHttpRequest.prototype.send;
XMLHttpRequest.prototype.send=function(s){if(!this._csrf){c.apply(this,arguments);
return
}if(g){this.setRequestHeader(j,g);
c.apply(this,arguments);
return
}var q=this;
var r=Array.prototype.slice.call(arguments);
p.then(function(t){q.setRequestHeader(j,t);
c.apply(q,r)
},function(){if(e.console){console.error("Unable to read CSRF meta information")
}c.apply(q,r)
})
};
var f=HTMLFormElement.prototype.submit;
HTMLFormElement.prototype.submit=function(){a(this);
return f.apply(this,arguments)
};
if(e.Node){var o=Node.prototype.appendChild;
Node.prototype.appendChild=function(){var q=o.apply(this,arguments);
if(q.nodeName==="IFRAME"){try{if(q.contentWindow&&!q._csrf){q._csrf=true;
n(q.contentWindow.document)
}}catch(r){if(q.src&&q.src.length&&i(q.src)){if(e.console){console.error("Unable to attach CSRF token an iframe element on the same origin")
}}}}return q
}
}setInterval(function(){l()
},300000)
})(this);
(function(a){$(a).on("submit","form#gc-rprt-prblm-form",function(e){e.preventDefault();
var c=$(this);
var d=c.data("properties");
d.submissionPage=window.location.href;
var h={broken:{text:c.find("input[id=problem1]").val(),selected:c.find("input[id=problem1]").is(":checked")?"Yes":"No",value:c.find("input[id=problem1]").is(":checked")&&($.trim(c.find("input[id=problem1-detail]").val())).length>0?c.find("input[id=problem1-detail]").val():"No response"},spelling:{text:c.find("input[id=problem2]").val(),selected:c.find("input[id=problem2]").is(":checked")?"Yes":"No",value:c.find("input[id=problem2]").is(":checked")&&(c.find("input[id=problem2-detail]").val()).length>0?c.find("input[id=problem2-detail]").val():"No response"},wrong:{text:c.find("input[id=problem3]").val(),selected:c.find("input[id=problem3]").is(":checked")?"Yes":"No",value:c.find("input[id=problem3]").is(":checked")&&(c.find("input[id=problem3-detail]").val()).length>0?c.find("input[id=problem3-detail]").val():"No response"},outdated:{text:c.find("input[id=problem4]").val(),selected:c.find("input[id=problem4]").is(":checked")?"Yes":"No",value:c.find("input[id=problem4]").is(":checked")&&(c.find("input[id=problem4-detail]").val()).length>0?c.find("input[id=problem4-detail]").val():"No response"},find:{text:c.find("input[id=problem5]").val(),selected:c.find("input[id=problem5]").is(":checked")?"Yes":"No",value:c.find("input[id=problem5]").is(":checked")&&(c.find("input[id=problem5-detail]").val()).length>0?c.find("input[id=problem5-detail]").val():"No response"},confusing:{text:c.find("input[id=problem6]").val(),selected:c.find("input[id=problem6]").is(":checked")?"Yes":"No",value:c.find("input[id=problem6]").is(":checked")&&(c.find("input[id=problem6-detail]").val()).length>0?c.find("input[id=problem6-detail]").val():"No response"},properties:d,referringPage:a.referrer||window.location.href};
$.ajax({type:"POST",url:"/gc/services/reportAProblem",dataType:"json",data:{formData:encodeURI(JSON.stringify(h))}});
var g=window.location.pathname;
var b=g.split("/");
var f=b[b.length-1];
if(f=="report-problem.html"||f=="report-problem"){window.location.href="/en/report-problem/thankyou.html"
}else{if(f=="signaler-probleme.html"||f=="signaler-probleme"){window.location.href="/fr/signaler-probleme/merci.html"
}else{c.closest(".gc-rprt-prblm").find(".gc-rprt-prblm-tggl").removeClass("hide").addClass("show")
}}})
})(document);
(function(a,b){b(a).ready(function(){b("a.fn-lnk").each(function(e){var d=b(this).attr("href");
var g=d.replace("#","");
var f=b(this).parent();
if(!f.id){var c=b("sup[id='"+g+"-0-rf']");
if(c.length>0){f.attr("id",g+"-"+e+"-rf")
}else{f.attr("id",g+"-0-rf")
}}});
b.each(b("p.fn-rtn a"),function(){var e=b(this).attr("href");
var d=e.indexOf("-");
var f=e.substring(1,d+1);
var c=b("sup[id^='"+f+"']");
if(c.length>0){b(this).attr("href","#"+c[0].id)
}});
b(a).on("mouseover","a.fn-lnk",function(f){var c=b(this).attr("href");
var d=b(this).parent();
var g=d.attr("id");
if(!g){b("a.fn-lnk").each(function(j){var h=b(this).attr("href");
var l=h.replace("#","");
var k=b(this).parent();
var e=b("sup[id='"+l+"-0-rf']");
if(e.length>0){k.attr("id",l+"-"+j+"-rf")
}else{k.attr("id",l+"-0-rf")
}});
b.each(b("p.fn-rtn a"),function(){var i=b(this).attr("href");
var h=i.indexOf("-");
var j=i.substring(1,h+1);
var e=b("sup[id^='"+j+"']");
if(e.length>0){b(this).attr("href","#"+e[0].id)
}})
}})
})
})(document,Granite.$);